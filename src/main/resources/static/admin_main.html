<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>管理员主页</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./css/foundation.min.css">
    <script src="js/vendor/jquery.js"></script>
    <link rel="stylesheet" href="css/foundation.css">
    <link rel="stylesheet" href="css/app.css">

    <script>
        $(document).ready(function() {
            $(document).foundation();
        });
    </script>

    <script>
        var currentLevel;
        var lastLevel;

        var currentQuestion;

        var allLevelList;

        var currentPage = 1;//分页
        var numPerPage = 6;//分页

        var answerQuestionCurrentPage = 1;
        var answerQuestionNumPerPage = 10;

        var allQuestionList;
        $(document).ready(function() {
            findAllLevel();
        });

        function findAllLevel(){
            $.ajax({
                url: "/level/findAllLevel",
                dataType: "text",
                success: function (result) {
                   var levelList = $.parseJSON(result);
                    allLevelList = levelList;
                   loadAllLevel(levelList);
                },
                error: function (e) {
                    alert("错误")
                }
            });
        }
        function loadAllLevel(levelList){
            $("#content").empty();
            for(var i = 0;i<levelList.length;i++){
                var level = levelList[i];
                lastLevel = level;

                var grade = level.grade;
                var experienceNeed = level.experienceNeed;
                var description = level.description;
                var rate = level.rate;


                var div1 = document.createElement("div");
                $(div1).addClass("cell small-12 medium-4 large-3 padding_vertical");
                var div2 = document.createElement("div");
                $(div2).addClass("grid-padding-x content_center").css({"box-shadow": "10px 10px 5px #888888","width":"150px","border-radius": "5px"});
                var div3_1 = document.createElement("div");
                $(div3_1).addClass("large-12 medium-12 ").css({"overflow":"hidden","background-color":"#3adb76", "height":"100px"});
                var span = document.createElement("span");
                $(span).css("padding: 0px auto");
                $(span).text("关卡"+grade);
                $(div3_1).append(span);
                var div3_2 = document.createElement("div");
                $(div3_2).addClass("large-12 medium-12 ").css({"overflow": "hidden", "height": "50px"});
                $(div3_2).text(description);
                div2.append(div3_1);
                div2.append(div3_2);
                div1.append(div2);

                $(div2).click({"level":level},showLevelInfo);
                $("#content").append(div1);

            }
        }

        function addLevel(){

            var grade = $("#grade").val();
          // var experience_need = $("#experience_need").val();
            var description = $("#description").val();
            var rate = $("#rate").val();

            var r = /^\+?[1-9][0-9]*$/;　　//正整数正则

            if(grade=="" || description == "" || rate == ""){
                $("#level_message").text("请输入完整").css({color:"red"});
                return false;
            }
    /*        if(! r.test(experience_need)){
                $("#level_message").text("所需经验应为整数").css({color:"red"});
                return false;
            }
            if(experience_need <= lastLevel.experienceNeed){
                $("#level_message").text("所需经验应大于"+lastLevel.experienceNeed).css({color:"red"});
                return false;
            }*/

            if(! r.test(rate)){
                $("#level_message").text("通过率应为整数").css({color:"red"});
                return false;
            }
            if(rate <= 0 || rate > 100){
                $("#level_message").text("通过率应在0到100之间").css({color:"red"});
                return false;
            }
            var level = new Object();
            level.grade = grade;
            level.experienceNeed = 0;
            level.description = description;
            level.rate = rate;

            var levelStr = JSON.stringify(level);

            $.ajax({
                url: "/level/addLevel",
                dataType: "text",
                type: "post",
                data: {"level":levelStr},
                success: function (result) {
                    if(result == "true"){
                        //关闭当前
                        closeAddLevelPanel();
                        findAllLevel();
                    }
                },
                error: function (e) {
                    alert("错误")
                }
            });
        }
        function updateLevelInfo(){
            var level_description = $("#level_description").text().trim();
            var level_rate = $("#level_rate").text().trim().replace("%","");

            var r = /^\+?[1-9][0-9]*$/;
            var level = new Object();
            level.lNo=currentLevel.lNo;

            var isUpdate = false;//是否更新
            if(level_description == "" || level_description == currentLevel.description) {
                $("#level_description").text(currentLevel.description);
            } else {
                level.description = level_description;
                isUpdate = true;
            }

            if(level_rate == "" || !r.test(level_rate)
                    || level_rate==currentLevel.rate
                || level_rate > 100) {
                $("#level_rate").text(currentLevel.rate+"%");
            } else {
                level.rate=level_rate;
                isUpdate = true;
            }

            if(!isUpdate) return;

            //将可改属性改为false
            $("#level_description, #level_rate").attr("contenteditable","fasle");
            var levelStr = JSON.stringify(level);
            $.ajax({
                url: "/level/updateLevel", dataType: "text", type: "post", data: {"level":levelStr},
                success: function (result) {
                    if(result == "true"){
                        showPopWindow(1000,"更新成功");
                        findAllLevel();
                    }else{
                        showPopWindow(1000,"更新失败");
                    }
                },
                error: function (e) {
                    alert("错误")
                }
            });
        }

        function addQuestionFromDb(){
            if(currentPage == 1){

                var maxw = document.documentElement.clientWidth;
                var maxh = document.documentElement.clientHeight;
                $("#add_question_from_db").css({"z-index":"99","backgroundColor":"white","position":"fixed",width:maxw+"px",height:maxh+"px","top":"50%","left":"50%","margin-left":(-maxw/2)+"px","margin-top":(-maxh/2)+"px"});
                $("#add_question_from_db").show();
                $("html").addClass("unfoces");
                $("body").addClass("unfoces");
                $("#add_question").addClass("unfoces");
                $("#add_level").addClass("unfoces");
                $("#level_info").addClass("unfoces");
            }

            //从服务器获取题，

            $.ajax({
                url: "/question/findQuestionFromDB",
                dataType: "text",
                type: "post",
                data: {"currentPage":currentPage,"numPerPage":numPerPage},
                success: function (result) {
                    if(result != ""){

                        loadQuestionFromDb($.parseJSON(result));
                    }else{
                        currentPage=0;
                    }

                },
                error: function (e) {
                    alert("错误")
                }
            });
        }

        function loadQuestionFromDb(questionList){

            var tbody = $("#question_list_from_db tbody");
            $(tbody).empty();
            for(var i = 0;i<questionList.length;i++){
                var question = questionList[i];
                var tr = document.createElement("tr");
                var td_operation = document.createElement("td");
                var input_checkbox = document.createElement("input");
                $(input_checkbox).attr("type","checkbox");
                $(input_checkbox).val(question.qNo);
                $(td_operation).append(input_checkbox);

                var td_description = document.createElement("td");
                $(td_description).text(question.questionDescription);
                var td_test_point = document.createElement("td");
                $(td_test_point).text(question.testPoint);
                var td_experience = document.createElement("td");
                $(td_experience).text(question.experienceValue);

                $(tr).append(td_operation,td_description,td_test_point,td_experience);
                $(tbody).append(tr);
            }
        }


        function changeQuestionFromDb(){
            currentPage++;
            addQuestionFromDb();
        }

        function selectAll(t){
            var tbody = $("#question_list_from_db tbody");
            var inputs = $(tbody).find("input");
            //alert(t.checked+",inputs.length:"+inputs.length);

            for(var i = 0;i<inputs.length;i++){
                var input = inputs[i];
                input.checked=t.checked;
            }
        }

        function addQuestionList(){
            var tbody = $("#question_list_from_db tbody");
            var inputs = $(tbody).find("input");

            var questionList = new Array();


            for(var i = 0;i<inputs.length;i++){
                var input = inputs[i];
                if(input.checked){
                    var question = new Object();
                    question.qNo = $(input).val();
                    question.lNo = currentLevel.lNo;
                    questionList.push(question);
                }
            }

            var questionListJson = JSON.stringify(questionList);

            $.ajax({
                url: "/question/addQuestionListFormDb",
                dataType: "text",
                type: "post",
                data: {"questionList":questionListJson},
                success: function (result) {
                    alert(result)
                    if(result == "true"){
                        currentPage=1;
                        closeAddQuestionFromDb();
                        //刷新关卡详情页
                        findAllQuestionByLNo(currentLevel.lNo);
                    }
                },
                error: function (e) {
                    alert("错误")
                }
            });


        }
        function addQuestion(){

            var question_description = $("#question_description").val().trim();
            var test_point = $("#test_point").val().trim();
            var choice_a = $("#choice_a").val().trim();
            var choice_b = $("#choice_b").val().trim();
            var choice_c = $("#choice_c").val().trim();
            var choice_d = $("#choice_d").val().trim();
            var choice_e = $("#choice_e").val().trim();
            var correct_option = $("#correct_option").val().trim();
            var answer_analysis = $("#answer_analysis").val().trim();
            var experience_value = $("#experience_value").val().trim();
            var lNo = currentLevel.lNo;

            if(question_description == "" || choice_a == "" || choice_b == "" || correct_option == "" || experience_value == ""){
                $("#question_message").text("请输入完整").css({color:"red"});
                return false;
            }

            var arr = new Array();
            if(choice_a.trim() != "") arr.push("A")
            if(choice_b.trim() != "") arr.push("B")
            if(choice_c.trim() != "") arr.push("C")
            if(choice_d.trim() != "") arr.push("D")
            if(choice_e.trim() != "") arr.push("E")
            var isCorrect = false;
            var message_choice = ""
            for(var i = 0;i<arr.length;i++){
                if(correct_option.trim() == arr[i]){
                    isCorrect = true;
                }
                message_choice += arr[i];
                if(i != arr.length-1) message_choice += ",";
            }
            if(!isCorrect){
                $("#question_message").text("正确选项请输入："+message_choice).css({color:"red"});
                return false;
            }

            var r = /^\+?[1-9][0-9]*$/;　　//正整数正则
            if(! r.test(experience_value)){
                $("#question_message").text("经验值/分值请输入整数").css({color:"red"});
                return false;
            }

            var question = new Object();
            question.questionDescription = question_description;
            question.testPoint = test_point;
            question.choiceA = choice_a;
            question.choiceB = choice_b;
            question.choiceC = choice_c;
            question.choiceD = choice_d;
            question.choiceE = choice_e;
            question.correctOption = correct_option;
            question.answerAnalysis = answer_analysis;
            question.experienceValue = experience_value;
            question.lNo = lNo;

            var questionJson = JSON.stringify(question);

            $.ajax({
                url: "/question/addQuestion",
                dataType: "text",
                type: "post",
                data: {"question":questionJson},
                success: function (result) {
                    if(result == "true"){
                        closeAddQuestionPanel();
                        //刷新关卡详情页
                        findAllQuestionByLNo(currentLevel.lNo);
                    }
                },
                error: function (e) {
                    alert("错误")
                }
            });
        }

        function findAllQuestionByLNo(lNo){
            $.ajax({
                url: "/question/findAllQuestionByLNo",
                dataType: "text",
                type: "post",
                data: {"lNo":lNo},
                success: function (result) {
                    var maxw = document.documentElement.clientWidth;
                    var maxh = document.documentElement.clientHeight;
                    $("#level_info").css({"z-index":"90","backgroundColor":"white","position":"fixed",width:maxw+"px",height:maxh+"px","top":"50%","left":"50%","margin-left":(-maxw/2)+"px","margin-top":(-maxh/2)+"px"});
                    $("#level_info").show();
                    $("html").addClass("unfoces");
                    $("body").addClass("unfoces");
                    $("#add_question").addClass("unfoces");
                    $("#add_level").addClass("unfoces");
                    $("#level_title").text("关卡"+currentLevel.grade);
                    $("#level_grade").text(currentLevel.grade);
                    $("#level_description").text(currentLevel.description);
                 //   $("#level_experience_need").text(currentLevel.experienceNeed);
                    $("#level_rate").text(currentLevel.rate+"%");

                    $("#add_question_button").click({"lNo":lNo},showAddQuestion);
                    if(currentLevel.lNo == allLevelList[allLevelList.length-1].lNo){
                        $("#delete_level").show();
                        $("#delete_level").click(deleteLevel);
                    }

                    allQuestionList = $.parseJSON(result);
                   // alert(result)
                    if(result != ""){
                        loadQuestions(allQuestionList);
                    }
                },
                error: function (e) {
                    alert("错误")
                }
            });
        }

        function showAddLevel(){

            var maxw = document.documentElement.clientWidth;
            var maxh = document.documentElement.clientHeight;
            $("#add_level").css({"z-index":"90","backgroundColor":"white","position":"fixed",width:maxw+"px",height:maxh+"px","top":"50%","left":"50%","margin-left":(-maxw/2)+"px","margin-top":(-maxh/2)+"px"});
            $("#add_level").show();
            $("html").addClass("unfoces");
            $("body").addClass("unfoces");
            $("#level_info").addClass("unfoces");
            $("#add_question").addClass("unfoces");

            $("#grade").val(lastLevel.grade+1);
            $("#experience_need").attr("placeholder","应大于"+lastLevel.experienceNeed);
            //closeLevelInfoPanel();

        }


        function showAddQuestion(d){

            var lNo = d.data.lNo;
            var maxw = document.documentElement.clientWidth;
            var maxh = document.documentElement.clientHeight;
            $("#add_question").css({"z-index":"91","backgroundColor":"white","position":"fixed",width:maxw+"px",height:maxh+"px","top":"50%","left":"50%","margin-left":(-maxw/2)+"px","margin-top":(-maxh/2)+"px"});
            $("#add_question").show();
            $("html").addClass("unfoces");
            $("body").addClass("unfoces");
            $("#level_info").addClass("unfoces");
            $("#add_level").addClass("unfoces");

            $("#lNo").val(lNo);


        }
        function showLevelInfo(d){

            currentLevel = d.data.level;

            findAllQuestionByLNo(currentLevel.lNo);

        }

        function loadQuestions(questionList){

            var tbody = $("#question_list tbody");
            $(tbody).empty();
            for(var i = 0;i<questionList.length;i++) {
                var question = questionList[i];
                var tr = document.createElement("tr");
                var td_description = document.createElement("td");
                var td_test_point = document.createElement("td");
                var td_experience_value = document.createElement("td");

                var td_operation = document.createElement("td");
                var a_showInfo = document.createElement("a");
                $(a_showInfo).text("查看 ");
                $(a_showInfo).click({"question":question},showQuestionInfo);

             /*   var a_edit = document.createElement("a");
                $(a_edit).text("编辑 ")*/
                var a_delete = document.createElement("a");
                $(a_delete).text("删除 ")
                $(a_delete).click({"qNo":question.qNo},deleteQuestionFromLevel);
                $(td_operation).append(a_showInfo, a_delete);

                $(td_description).text(question.questionDescription)
                $(td_test_point).text(question.testPoint)
                $(td_experience_value).text(question.experienceValue)
                $(tr).append(td_description, td_test_point, td_experience_value, td_operation);


                $(tbody).append(tr)
            }

        }

        function showQuestionInfo(d){
            var question = d.data.question;

            currentQuestion=question;
            var maxw = document.documentElement.clientWidth;
            var maxh = document.documentElement.clientHeight;
            $("#question_info").css({"z-index":"91","backgroundColor":"white","position":"fixed",width:maxw+"px",height:maxh+"px","top":"50%","left":"50%","margin-left":(-maxw/2)+"px","margin-top":(-maxh/2)+"px"});
            $("#question_info").show();
            $("html").addClass("unfoces");
            $("body").addClass("unfoces");
            $("#level_info").addClass("unfoces");
            $("#add_level").addClass("unfoces");
           // alert("question:"+question.qNo+",description:"+question.questionDescription)

            $("#td_question_description").text(question.questionDescription);
            $("#td_choice_a").text(question.choiceA);
            $("#td_choice_b").text(question.choiceB);
            $("#td_choice_c").text(question.choiceC);
            $("#td_choice_d").text(question.choiceD);
            $("#td_choice_e").text(question.choiceE);
            $("#td_correct_choice").text(question.correctOption);
            $("#td_answer_analysis").text(question.answerAnalysis);
            $("#td_experience_value").text(question.experienceValue);

        }

        function updateQuestionInfo(){
            var td_question_description = $("#td_question_description").text().trim();
            var td_choice_a = $("#td_choice_a").text().trim();
            var td_choice_b = $("#td_choice_b").text().trim();
            var td_choice_c = $("#td_choice_c").text().trim();
            var td_choice_d = $("#td_choice_d").text().trim();
            var td_choice_e = $("#td_choice_e").text().trim();
            var td_correct_choice =   $("#td_correct_choice").text().trim();
            var td_answer_analysis =  $("#td_answer_analysis").text().trim();
            var td_experience_value = $("#td_experience_value").text().trim();


            var question = new Object();
            var isUpdate = false;
            question.qNo = currentQuestion.qNo;
            var r = /^\+?[1-9][0-9]*$/;　　//正整数正则
            if(! r.test(td_experience_value)){
               // $("#question_message").text("经验值/分值请输入整数").css({color:"red"});
                showPopWindow(1000,"分值数值不对");
                return false;
            }
            if(td_question_description == "" || td_question_description == currentQuestion.questionDescription){
                $("#td_question_description").text(currentQuestion.questionDescription);
            }else{
                isUpdate = true;
                question.questionDescription=td_question_description;
            }

            if(td_choice_a == "" || td_choice_a==currentQuestion.choiceA){
                $("#td_choice_a").text(currentQuestion.choiceA);
            }else{
                isUpdate = true;
                question.choiceA=td_choice_a;
            }

            if(td_choice_b == "" || td_choice_b==currentQuestion.choiceB){
                $("#td_choice_b").text(currentQuestion.choiceB);
            }else{
                isUpdate = true;
                question.choiceB=td_choice_b;
            }
            if(td_choice_c == "" || td_choice_c==currentQuestion.choiceC){
                $("#td_choice_c").text(currentQuestion.choiceC);
            }else{
                isUpdate = true;
                question.choiceC=td_choice_c;
            }

            if(td_choice_d == "" || td_choice_d==currentQuestion.choiceD){
                $("#td_choice_d").text(currentQuestion.choiceD);
            }else{
                isUpdate = true;
                question.choiceD=td_choice_d;
            }

            if((td_choice_e == "" || td_choice_e==currentQuestion.choiceE)){
                $("#td_choice_e").text(currentQuestion.choiceE);
            }else{
                isUpdate = true;
                question.choiceE=td_choice_e;
            }

            if(td_correct_choice == "" || td_correct_choice==currentQuestion.correctOption){
                $("#td_correct_choice").text(currentQuestion.correctOption);
            }else{
                isUpdate = true;
                question.correctOption=td_correct_choice;
            }

            if(td_answer_analysis == "" || td_answer_analysis==currentQuestion.answerAnalysis){
                $("#td_answer_analysis").text(currentQuestion.answerAnalysis);
            }else{
                isUpdate = true;
                question.answerAnalysis=td_answer_analysis;
            }
            if(td_experience_value == "" || td_experience_value==currentQuestion.experienceValue){
                $("#td_experience_value").text(currentQuestion.experienceValue);
            }else{
                isUpdate = true;
                question.experienceValue=td_experience_value;
            }

            if(!isUpdate) return;



            $("#td_question_description, #td_choice_a, #td_choice_b, #td_choice_c, " +
                "#td_choice_e, #td_correct_choice, #td_answer_analysis, #td_experience_value").attr("contenteditable","false");

            var questionJson = JSON.stringify(question);
           // alert(questionJson);
            $.ajax({
                url: "/question/updateQuestion", dataType: "text", type: "post",
                data: {"question":questionJson},
                success: function (result) {
                    if(result == "true"){
                        showPopWindow(1000,"更新成功");
                        findAllQuestionByLNo(currentLevel.lNo);
                    }
                },
                error: function (e) {
                    alert("错误")
                }
            });


        }

        function  deleteQuestionFromLevel(d) {
            var qNo = d.data.qNo;
            $.ajax({
                url: "/question/deleteQuestionFromLevel",
                dataType: "text",
                type: "post",
                data: {"qNo":qNo},
                success: function (result) {

                    if(result == "true"){
                        //重新加载题目列表
                        findAllQuestionByLNo(currentLevel.lNo);
                    }
                },
                error: function (e) {
                    alert("错误")
                }
            });

        }

        function editQuestion(t){
            $(t).attr("contenteditable","true");
        }

        function editLevelRate(){
            $("#level_rate").attr("contenteditable","true");
        }
        function editLevelDescription(){
            $("#level_description").attr("contenteditable","true");
        }


        function showAddQuestionFromFile(){
            var maxw = document.documentElement.clientWidth;
            var maxh = document.documentElement.clientHeight;
            $("#add_question_from_file").css({"z-index":"80","backgroundColor":"white","position":"fixed",width:maxw+"px",height:maxh+"px","top":"50%","left":"50%","margin-left":(-maxw/2)+"px","margin-top":(-maxh/2)+"px"});
            $("#add_question_from_file").show();
            $("html").addClass("unfoces");
            $("body").addClass("unfoces");
            $("#level_info").addClass("unfoces");
        }
        function uploadQuestionFile(){
            var formdata = new FormData(document.getElementById("form"));
            $.ajax({
                url: "/question/uploadQuestionFile",
                type: "post",
                data:formdata,
                dataType:"text",
                processData: false,
                contentType: false,
                success:function(result){
                    if(result=="true"){
                        showPopWindow(1000,"上传成功")
                    }else{
                        showPopWindow(1000,"上传失败")
                    }
                },
                error:function(e){
                    showPopWindow(1000,"网络错误")
                }
            });
        }


        function deleteLevel(){
            var r = confirm("确认要删除吗？删除之后不能回退");
            if (r == true) {
                $.ajax({
                    url: "/level/deleteLevel",
                    type: "post",
                    data:"lNo="+currentLevel.lNo,
                    dataType:"text",
                    success:function(result){
                        if(result=="true"){
                            showPopWindow(1000,"删除成功")
                            closeLevelInfoPanel(true);
                            findAllLevel();
                        }
                    },
                    error:function(e){
                        showPopWindow(1000,"网络错误")
                    }
                });
            }
        }



        function showAnswerQuestionHistory(currentPage,numPerPage){
            $.ajax({
                url: "/userQuestion/getUserQuestionInfoByPage",
                type: "post",
                data:"currentPage="+currentPage+"&numPerPage="+numPerPage,
                dataType:"text",
                success:function(result){
                    if(result!=""){

                        var maxw = document.documentElement.clientWidth;
                        var maxh = document.documentElement.clientHeight;
                        $("#answer_question_history").css({"z-index":"90","backgroundColor":"white","position":"fixed",width:maxw+"px",height:maxh+"px","top":"50%","left":"50%","margin-left":(-maxw/2)+"px","margin-top":(-maxh/2)+"px"});
                        $("#answer_question_history").show();
                        $("html").addClass("unfoces");
                        $("body").addClass("unfoces");


                        userQuestionInfoList = $.parseJSON(result);
                        if(answerQuestionCurrentPage <= 1){
                            $("#previous_page").hide();
                        }else{
                            $("#previous_page").show();
                        }
                        if(userQuestionInfoList.length < answerQuestionNumPerPage){
                            //隐藏下一页
                            $("#next_page").hide();
                        }else{
                            $("#next_page").show();
                        }
                        loadAnswerQuestionHistoryList(userQuestionInfoList);
                    }
                },
                error:function(e){
                    showPopWindow(1000,"网络错误")
                }
            });
        }

        function previousPage(){
            answerQuestionCurrentPage --;
            showAnswerQuestionHistory(answerQuestionCurrentPage,answerQuestionNumPerPage)
        }
        function nextPage(){
            answerQuestionCurrentPage ++;
            showAnswerQuestionHistory(answerQuestionCurrentPage,answerQuestionNumPerPage)
        }

        function loadAnswerQuestionHistoryList(userQuestionInfoList){
            var tbody = $("#answer_question_list tbody");
            $(tbody).empty();

            for(var i = 0;i<userQuestionInfoList.length;i++) {
                var userQuestionInfo = userQuestionInfoList[i];
                var question = userQuestionInfo.question;
                var userQuestion = userQuestionInfo.userQuestion;
                var user = userQuestionInfo.user;
                var level = userQuestionInfo.level;
                var tr = document.createElement("tr");
                var td_level = document.createElement("td");
                var td_description = document.createElement("td");
                var td_experience_value = document.createElement("td");
                var td_answer_user = document.createElement("td");

                var td_correctness = document.createElement("td");
                var td_answer_time = document.createElement("td");

                var a_showInfo = document.createElement("a");
                $(a_showInfo).text(question.questionDescription);
                $(a_showInfo).click({"question":question},showAnswerQuestionInfo);


                $(td_level).text("关卡"+level.grade)
                $(td_description).append(a_showInfo)
                $(td_experience_value).text(question.experienceValue)
                $(td_answer_user).text(user.name)
                $(td_correctness).text(userQuestion.correctness=="Y"?"正确":"错误")
                $(td_answer_time).text(userQuestion.date)

                $(tr).append(td_level,td_description, td_experience_value,td_answer_user,td_correctness,td_answer_time);

                $(tbody).append(tr)
            }
        }

        function showAnswerQuestionInfo(d){

            showQuestionInfo(d)

        }
        function closeAnswerQuestionHistory(){
            $('#answer_question_history').fadeOut(500);
            $("html").removeClass("unfoces");
            $("body").removeClass("unfoces");
        }
        function closeAddQuestionFromDb(){
            $('#add_question_from_db').fadeOut(500);
            $("html").removeClass("unfoces");
            $("body").removeClass("unfoces");
            $("#add_question").removeClass("unfoces");
            $("#level_info").removeClass("unfoces");
            $("#add_level").removeClass("unfoces");
        }
        function closeAddLevelPanel(){
            $('#add_level').fadeOut(500);
            $("html").removeClass("unfoces");
            $("body").removeClass("unfoces");
            $("#add_question").removeClass("unfoces");
            $("#level_info").removeClass("unfoces");
            $("#add_question_from_db").removeClass("unfoces");
        }
        function closeLevelInfoPanel(t){
            if(t){

            }else{
                var grade= currentLevel.grade;
                var row = Math.floor(grade/2 +3);//矩阵行数
                var col = Math.floor((grade-1)/2 + 3);//矩阵列数
                var s = row*col;
                var q = Math.floor((s+1)/2);//问题数量
                if(allQuestionList.length < q){
                    alert("题目数量不够，至少需要添加"+q+"个题，请继续添加！！！")
                    return;
                }
            }


            $('#level_info').fadeOut(500);
            $("html").removeClass("unfoces");
            $("body").removeClass("unfoces");
            $("#add_question").removeClass("unfoces");
            $("#add_level").removeClass("unfoces");
            $("#add_question_from_db").removeClass("unfoces");
        }
        function closeAddQuestionPanel(){
            $('#add_question').fadeOut(500);
            $("html").removeClass("unfoces");
            $("body").removeClass("unfoces");
            $("#add_level").removeClass("unfoces");
            $("#level_info").removeClass("unfoces");
            $("#add_question_from_db").removeClass("unfoces");
        }
        function closeQuestionInfoPanel(){
            $('#question_info').fadeOut(500);
            $("html").removeClass("unfoces");
            $("body").removeClass("unfoces");
            $("#add_level").removeClass("unfoces");
            $("#level_info").removeClass("unfoces");
            $("#add_question_from_db").removeClass("unfoces");
        }
        function closeAddQuestionFromFile(){
            $('#add_question_from_file').fadeOut(500);
            $("html").removeClass("unfoces");
            $("body").removeClass("unfoces");
            $("#add_level").removeClass("unfoces");
            $("#level_info").removeClass("unfoces");
        }


    </script>

    <style>
        div{
            border: 0px solid;
        }


    </style>


</head>
<body>
<div id="header">
    <script>$("#header").load("admin_nav.html")</script>
</div>

<div class="grid-container  fluid margin_top" >
    <div class="cell text-right" style="position: sticky;position: -webkit-sticky; top: 0px;">
        <button class="button dark"  id="add_question_from_file_button" onclick="showAddQuestionFromFile()">从文件中导入题</button>
        <button class="button dark"  id="add_level_button" onclick="showAddLevel()">添加关卡</button>
    </div>

    <div id="content" class="grid-x grid-margin-x grid-margin-y">
        <!--div1-->
        <div class="cell small-12 medium-4 large-3 padding_vertical" >
            <!--div2-->
            <div class="grid-padding-x content_center" style="box-shadow: 10px 10px 5px #888888; width: 150px;border-radius: 5px">
                <!--div3_img-->
                <div class="large-12 medium-12 content_center" style="overflow: hidden; background-color: #3adb76; height: 100px;">
                    <span style="padding: 0px auto">关卡1</span>
                </div>
                <!--div3_content-->
                <div class="large-12 medium-12 content_center" style="overflow: hidden; height: 50px;" >
                    关卡描述 关卡描述关卡描述 关卡描述关卡描述 关卡描述关卡描述 关卡描述关卡描述 关卡描述关卡描述 关卡描述
                </div>
            </div>
        </div>
    </div>
</div>

<div  id="level_info" style="position: fixed; display: none; padding: 1rem;overflow-y: auto;overflow-scrolling: inherit">
    <div class="text-right" style="position: sticky;position: -webkit-sticky; top: 0px;">
        <button class="button dark"  onclick="addQuestionFromDb()">从题库添加选择题</button>
        <button class="button dark"  id="add_question_button">添加选择题</button>
        <button class="button warning" style="display: none"  id="delete_level">删除此关卡</button>
        <button onclick="closeLevelInfoPanel()" class="button success">关闭</button>
    </div>

    <h3 id="level_title" style="font-weight: bold"></h3>
    <div class="grid-padding-x">
        <div class="cell small-12 medium-4" id="level_info_content">
            <table>
                <tbody>
                    <tr>
                        <td>关卡等级:</td><td id="level_grade"></td>
                    </tr>
                    <tr>
                        <td>描述:</td><td id="level_description" onblur="updateLevelInfo()"   ondblclick="editLevelDescription()"></td>
                    </tr>
                  <!--  <tr>
                        <td>所需经验:</td><td id="level_experience_need" ></td>
                    </tr>-->
                    <tr>
                        <td>通关率(单位：%):</td><td id="level_rate" onblur="updateLevelInfo()"  ondblclick="editLevelRate()"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="cell small-12 medium-8" id="question_list">
            <div>
                <table>
                    <thead>
                        <tr>
                            <th>问题描述</th><th>考点</th><th>经验值</th><th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td><td></td><td></td><td><a>查看 </a><a>删除</a></td>
                        </tr>

                    </tbody>
                </table>

            </div>
        </div>

    </div>
    <hr/>

</div>

<div  id="add_question_from_db" style="position: fixed; display: none; padding: 1rem;overflow-y: auto;overflow-scrolling: inherit">
    <div class="text-right" style="position: sticky;position: -webkit-sticky; top: 0px;">
        <button onclick="changeQuestionFromDb()" class="button success">换一批</button>
        <button onclick="closeAddQuestionFromDb()" class="button success">关闭</button>
    </div>

    <div class="grid-padding-x">

        <div class="cell small-12 medium-8" id="question_list_from_db">
            <div>
                <table>
                    <thead>
                    <tr>
                        <th>操作</th><th>问题描述</th><th>考点</th><th>经验值</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td><input type="checkbox" value="1"/></td> <td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" value="1"/></td> <td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" value="1"/></td> <td></td><td></td><td></td>
                    </tr>


                    </tbody>
                    <tfoot>
                        <tr>
                            <td><label>全选:<input type="checkbox" onclick="selectAll(this)"/></label></td>
                            <td><button class="button success" onclick="addQuestionList()">添加</button></td> <td></td> <td></td> <td></td>
                        </tr>
                    </tfoot>
                </table>

            </div>
        </div>

    </div>
    <hr/>

</div>

<div  id="question_info" style="position: fixed; display: none; padding: 1rem;overflow-y: auto;overflow-scrolling: inherit">
    <div class="text-right" style="position: sticky;position: -webkit-sticky; top: 0px;">
        <button onclick="closeQuestionInfoPanel()" class="button success">关闭</button>
    </div>
    <div class="grid-padding-x">
        <div class="cell small-12 medium-4" id="question_info_content">
            <table>
                <tbody>
                <tr>
                    <td>问题描述:</td><td id="td_question_description" onblur="updateQuestionInfo()"   ondblclick="editQuestion(this)"></td>
                </tr>
                <tr>
                    <td>A选项:</td><td id="td_choice_a" onblur="updateQuestionInfo()"   ondblclick="editQuestion(this)"></td>
                </tr>
                <tr>
                    <td>B选项:</td><td id="td_choice_b" onblur="updateQuestionInfo()"   ondblclick="editQuestion(this)"></td>
                </tr>
                <tr>
                    <td>C选项:</td><td id="td_choice_c" onblur="updateQuestionInfo()"  ondblclick="editQuestion(this)"></td>
                </tr>
                <tr>
                    <td>D选项:</td><td id="td_choice_d" onblur="updateQuestionInfo()"  ondblclick="editQuestion(this)"></td>
                </tr>
                <tr>
                    <td>E选项:</td><td id="td_choice_e" onblur="updateQuestionInfo()"  ondblclick="editQuestion(this)"></td>
                </tr>
                <tr>
                    <td>正确选项:</td><td id="td_correct_choice" onblur="updateQuestionInfo()"  ondblclick="editQuestion(this)"></td>
                </tr>
                <tr>
                    <td>答案解析:</td><td id="td_answer_analysis" onblur="updateQuestionInfo()"  ondblclick="editQuestion(this)"></td>
                </tr>
                <tr>
                    <td>分值:</td><td id="td_experience_value" onblur="updateQuestionInfo()"  ondblclick="editQuestion(this)"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>







<div id="add_level"  style="position: fixed; display: none; padding: 1rem;overflow-y: auto;overflow-scrolling: inherit">
    <div class="content_center grid-container" >
        <div class="text-right" style="position: sticky;position: -webkit-sticky; top: 0px;">
            <button onclick="closeAddLevelPanel()" class="button success">关闭</button>
        </div>
        <h1>添加关卡</h1>
        <label for="grade">关卡等级
            <input type="text" placeholder="grade" readonly id="grade" >
        </label>
<!--        <label for="experience_need">所需经验
            <input type="text" placeholder="解锁关卡所需要的经验值" id="experience_need">
        </label>-->
        <label for="description">描述
            <input type="text" placeholder="关卡描述" id="description">
        </label>
        <label for="rate">通关率
            <input type="text" placeholder="通关率应在0到100之间" id="rate">
        </label>
        <button onclick="addLevel()" class="button success">添加</button><span id="level_message"></span>
    </div>
</div>

<div id="add_question_from_file"  style="position: fixed; display: none; padding: 1rem;overflow-y: auto;overflow-scrolling: inherit">
    <div class="content_center grid-container" >
        <div class="text-right" style="position: sticky;position: -webkit-sticky; top: 0px;">
            <button onclick="closeAddQuestionFromFile()" class="button success">关闭</button>
        </div>
        <h1>请上传文件</h1>
        <form id="form">

            <input type="file"  id="file" name="file" placeholder="file">

            <button type="button" onclick="uploadQuestionFile()" class="button success">提交</button>
        </form>
    </div>
</div>



<div  id="answer_question_history" style="position: fixed; display: none; padding: 1rem;overflow-y: auto;overflow-scrolling: inherit">
    <div class="text-right" style="position: sticky;position: -webkit-sticky; top: 0px;">
        <button onclick="previousPage()" class="button success" id="previous_page">上一页</button>
        <button onclick="nextPage()" class="button success" id="next_page">下一页</button>
        <button onclick="closeAnswerQuestionHistory()" class="button success">关闭</button>
    </div>

    <div class="grid-padding-x">

        <div class="cell small-12 medium-8" id="answer_question_list">
            <div>
                <table>
                    <thead>
                    <tr>
                        <th>关卡</th><th>问题描述</th><th>分值</th><th>答题人</th><th>正确性</th><th>时间</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td><input type="checkbox" value="1"/></td> <td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" value="1"/></td> <td></td><td></td><td></td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" value="1"/></td> <td></td><td></td><td></td>
                    </tr>


                    </tbody>

                </table>

            </div>
        </div>

    </div>
    <hr/>

</div>



<div  id="add_question" style="position: fixed; display: none; padding: 1rem;overflow-y: auto;overflow-scrolling: inherit">

    <div class="content_center grid-container">
        <h1>添加选择题</h1>
        <div class="text-right" style="position: sticky;position: -webkit-sticky; top: 0px;">
            <button onclick="closeAddQuestionPanel()" class="button success">关闭</button>
        </div>
        <input type="hidden" id="lNo" >
        <label for="question_description">问题描述
            <input type="text" placeholder="描述一下问题" id="question_description" >
        </label>
        <label for="test_point">考点
            <input type="text" placeholder="考点" id="test_point" >
        </label>
        <label for="choice_a">A选项
            <input type="text" placeholder="A选项" id="choice_a">
        </label>
        <label for="choice_b">B选项
            <input type="text" placeholder="B选项" id="choice_b">
        </label>
        <label for="choice_c">C选项
            <input type="text" placeholder="C选项" id="choice_c">
        </label>
        <label for="choice_d">D选项
            <input type="text" placeholder="D选项" id="choice_d">
        </label>
        <label for="choice_e">E选项
            <input type="text" placeholder="E选项" id="choice_e">
        </label>
        <label for="correct_option">正确选项
            <input type="text" placeholder="正确选项" id="correct_option">
        </label>
        <label for="answer_analysis">答案解析
            <input type="text" placeholder="答案解析" id="answer_analysis">
        </label>
        <label for="experience_value">分值/经验值
            <input type="text" placeholder="分值/经验值" id="experience_value">
        </label>
        <button onclick="addQuestion()" class="button success">添加</button><span id="question_message"></span>

    </div>
</div>


<script>

    function showPopWindow(t,message){

        $("#pop_window").text(message);
        $("#pop_window").show().fadeOut(t);
    }
</script>

<div id="pop_window"   style="border:1px solid red;
			color: white; background-color: #000000;  opacity:0.9;
			z-index: 100;
			width:160px;height:120px; text-align: center; display: none;
			border-radius: 10px; font-size: 30px; line-height: 120px;
			position:absolute;left:50%;margin-left:-80px;top:50%;margin-top:-60px;">
    空白
</div>


<!--底部版权-->

<div id="footer">
    <script>$("#footer").load("footer.html")</script>
</div>

</body>
</html>


<script src="js/vendor/what-input.js"></script>
<script src="js/vendor/foundation.js"></script>
<script src="js/app.js"></script>